# WordPress統合リスク評価書

## 📋 管理会社からの重要情報（2025-01-31受領）

### 現状確認事項
1. **ACF使用状況**: 書籍ページのほぼ全要素がACFで構築
2. **投稿タイプ**: カスタム投稿タイプを使用
3. **カスタマイズレベル**: かなりカスタマイズされたサイト
4. **懸念事項**: REST API導入による既存ACFへの影響リスク

---

## 🚨 リスク評価

### 高リスク項目

#### 1. 既存ACFフィールドとの競合
- **リスクレベル**: 🔴 高
- **影響範囲**: サイト全体の表示崩れ可能性
- **発生確率**: 中程度
- **対策**: 
  - テスト環境での徹底検証
  - 段階的導入アプローチ
  - ロールバック計画の準備

#### 2. カスタム投稿タイプの互換性
- **リスクレベル**: 🟡 中
- **影響範囲**: 書籍ページの機能不全
- **発生確率**: 低～中程度
- **対策**:
  - 既存の投稿タイプ設定の詳細調査
  - REST APIエンドポイントの慎重な設計

### 中リスク項目

#### 3. パフォーマンスへの影響
- **リスクレベル**: 🟡 中
- **影響範囲**: サイト表示速度低下
- **発生確率**: 低程度
- **対策**:
  - キャッシュ戦略の実装
  - 非同期処理の採用

#### 4. セキュリティ脆弱性
- **リスクレベル**: 🟡 中  
- **影響範囲**: 不正アクセスリスク
- **発生確率**: 低程度（適切な対策により）
- **対策**:
  - JWT認証の実装
  - IPアドレス制限
  - レート制限

---

## 🛡️ リスク軽減戦略

### 1. 段階的実装アプローチ

#### Phase 1-改: 最小限の影響での実装
```
Week 1-2: 読み取り専用APIテスト
- 既存データの読み取りのみ
- 書き込み機能なし
- 影響度：最小

Week 3-4: 限定的書き込みテスト
- 新規フィールドのみ追加
- 既存フィールドは触らない
- 1件ずつ手動確認

Week 5-6: 本格実装
- 管理会社立ち会いでの実装
- リアルタイム監視
- 即時ロールバック体制
```

### 2. 安全な実装パターン

#### A. 専用フィールドグループ方式（推奨）
```php
// 既存のACFフィールドとは完全に分離
$sales_links_group = array(
    'key' => 'group_izumi_sales_links',
    'title' => 'いずみノベルズ販売リンク（自動更新）',
    'fields' => array(
        array(
            'key' => 'field_izumi_links_data',
            'label' => '販売リンクJSON',
            'name' => 'izumi_sales_links_json',
            'type' => 'textarea',
        ),
    ),
    'location' => array(
        array(
            array(
                'param' => 'post_type',
                'operator' => '==',
                'value' => 'books', // 実際の投稿タイプ名に変更
            ),
        ),
    ),
);
```

#### B. 既存フィールド非接触原則
- 新規フィールドのみ作成・更新
- 既存フィールドは読み取りのみ
- 名前空間の完全分離（prefix: `izumi_`）

### 3. テスト計画

#### テスト環境要件
- 本番環境の完全コピー
- 全プラグイン・テーマを同一バージョンに
- 実データのサブセットを使用

#### テストシナリオ
1. **基本動作テスト**
   - [ ] 既存ページの表示確認
   - [ ] 管理画面の動作確認
   - [ ] ACF編集画面の正常動作

2. **API統合テスト**
   - [ ] 読み取りAPIテスト
   - [ ] 書き込みAPIテスト（新規フィールド）
   - [ ] エラーハンドリング

3. **負荷テスト**
   - [ ] 同時アクセステスト
   - [ ] 大量データ更新テスト

4. **ロールバックテスト**
   - [ ] データ復旧手順確認
   - [ ] 設定復旧手順確認

---

## 🔄 代替案の検討

### 案1: データベース直接更新（非推奨）
- **メリット**: ACFへの影響なし
- **デメリット**: 
  - WordPressの整合性リスク
  - アップデート時の問題
  - 保守性の低下

### 案2: カスタムテーブル方式
- **メリット**: 
  - 既存システムから完全独立
  - パフォーマンス優位
- **デメリット**:
  - 開発工数増加
  - 管理画面での編集不可

### 案3: 外部API + iframe表示（安全案）
- **メリット**:
  - WordPressへの影響ゼロ
  - 完全な独立性
- **デメリット**:
  - SEOへの影響
  - デザイン統一性の課題

### 案4: 手動更新支援ツール（最安全案）
- **メリット**:
  - リスクゼロ
  - 段階的自動化可能
- **デメリット**:
  - 完全自動化未達成
  - 作業時間削減効果限定的（90%→70%）

---

## 📊 リスク対応マトリクス

| リスク項目 | 影響度 | 発生確率 | 対応優先度 | 対応策 |
|-----------|--------|----------|------------|--------|
| ACF競合 | 高 | 中 | 最優先 | テスト環境検証 |
| データ消失 | 高 | 低 | 優先 | バックアップ強化 |
| 表示崩れ | 中 | 中 | 優先 | 段階的実装 |
| 性能劣化 | 中 | 低 | 通常 | キャッシュ実装 |
| 権限エラー | 低 | 中 | 通常 | 事前設定確認 |

---

## 🚦 Go/No-Go判断基準

### Go条件（全て満たすこと）
1. ✅ テスト環境での全テスト合格
2. ✅ 管理会社の書面承認
3. ✅ ロールバック手順の確立
4. ✅ 1週間の並行稼働成功

### No-Go条件（1つでも該当したら中止）
1. ❌ 既存機能への影響発見
2. ❌ データ不整合の発生
3. ❌ 管理会社からの懸念表明
4. ❌ 復旧時間が1時間超

---

## 📝 推奨アクションプラン

### 即時実施事項
1. **管理会社との詳細確認**
   - 現在のACFフィールド一覧の取得
   - カスタム投稿タイプの詳細仕様
   - テスト環境の提供依頼

2. **技術検証**
   - ACF REST API設定の確認
   - 既存エンドポイントの調査
   - 認証方式の確認

3. **リスク軽減策の選択**
   - 案3（外部API）or 案4（手動支援）も検討
   - 管理会社の意向確認

### 中期対応事項
1. **プロトタイプ開発**
   - 最小機能での実装
   - 影響範囲の限定

2. **段階的移行計画**
   - 手動プロセスからの段階的自動化
   - 各段階での効果測定

---

## 🤝 管理会社への提案

### 提案1: 超安全アプローチ
「まずは読み取り専用の販売リンク表示システムを構築し、更新は従来通り手動で行う。システムの安定性を確認後、段階的に自動更新機能を追加」

### 提案2: 独立システムアプローチ  
「WordPressとは独立した販売リンク管理システムを構築し、APIやiframeで連携。既存システムへの影響を完全に排除」

### 提案3: 支援ツールアプローチ
「完全自動化ではなく、販売リンクを自動収集して管理画面に表示。最終的な更新は人間が確認して実行する半自動化」

---

**作成日**: 2025-01-31  
**重要度**: 🔴 最重要  
**次回アクション**: 管理会社との追加確認ミーティング